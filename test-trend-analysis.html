<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Analysis Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background: #0056b3;
        }
        .button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #e9ecef;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .config-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .config-item {
            display: flex;
            flex-direction: column;
        }
        .config-item label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .config-item select, .config-item input {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .platform-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }
        .platform-header {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            text-transform: capitalize;
        }
        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }
        .hashtag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
        .hashtag {
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Social Media Trend Analysis Test</h1>
            <p>Test the comprehensive trend analysis system with real-time data and AI-powered insights</p>
        </div>

        <!-- Configuration Section -->
        <div class="test-section">
            <h3>üìä Analysis Configuration</h3>
            <div class="config-section">
                <div class="config-item">
                    <label for="region">Region:</label>
                    <select id="region">
                        <option value="global">Global</option>
                        <option value="us">United States</option>
                        <option value="uk">United Kingdom</option>
                        <option value="india">India</option>
                        <option value="canada">Canada</option>
                        <option value="australia">Australia</option>
                    </select>
                </div>
                <div class="config-item">
                    <label for="industry">Industry:</label>
                    <select id="industry">
                        <option value="">All Industries</option>
                        <option value="fitness">Fitness & Health</option>
                        <option value="tech">Technology</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="business">Business</option>
                        <option value="education">Education</option>
                        <option value="entertainment">Entertainment</option>
                        <option value="food">Food & Beverage</option>
                        <option value="fashion">Fashion & Beauty</option>
                        <option value="travel">Travel</option>
                        <option value="finance">Finance</option>
                    </select>
                </div>
                <div class="config-item">
                    <label for="platform">Platform Focus:</label>
                    <select id="platform">
                        <option value="all">All Platforms</option>
                        <option value="instagram">Instagram</option>
                        <option value="facebook">Facebook</option>
                        <option value="linkedin">LinkedIn</option>
                        <option value="youtube">YouTube</option>
                        <option value="twitter">Twitter/X</option>
                        <option value="tiktok">TikTok</option>
                    </select>
                </div>
                <div class="config-item">
                    <label>
                        <input type="checkbox" id="competitorAnalysis"> Include Competitor Analysis
                    </label>
                </div>
            </div>
            
            <button class="button" onclick="generateTrendReport()">üöÄ Generate Comprehensive Report</button>
            <button class="button" onclick="getQuickInsights()">‚ö° Quick Insights</button>
            <button class="button" onclick="testAllEndpoints()">üß™ Test All Endpoints</button>
        </div>

        <!-- Results Section -->
        <div class="test-section">
            <h3>üìà Analysis Results</h3>
            <div id="results" class="result">
                Click "Generate Comprehensive Report" to start the trend analysis...
            </div>
        </div>

        <!-- Platform Overview -->
        <div class="test-section" id="platformOverview" style="display: none;">
            <h3>üåê Platform Overview</h3>
            <div id="platformGrid" class="platform-grid">
                <!-- Platform cards will be inserted here -->
            </div>
        </div>

        <!-- Content Calendar -->
        <div class="test-section" id="contentCalendar" style="display: none;">
            <h3>üìÖ Content Calendar</h3>
            <div id="calendarContent">
                <!-- Calendar content will be inserted here -->
            </div>
        </div>
    </div>

    <script>
        let currentReport = null;

        // Get authentication token (fallback for testing)
        function getAuthToken() {
            return localStorage.getItem('accessToken') || 'test-token';
        }

        // API request helper
        async function apiRequest(endpoint, options = {}) {
            const token = getAuthToken();
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`,
                    ...options.headers
                }
            };

            try {
                const response = await fetch(endpoint, { ...defaultOptions, ...options });
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Request failed:', error);
                throw error;
            }
        }

        // Show loading state
        function showLoading(message = 'Processing...') {
            const results = document.getElementById('results');
            results.className = 'result loading';
            results.textContent = `‚è≥ ${message}`;
        }

        // Show success result
        function showSuccess(data) {
            const results = document.getElementById('results');
            results.className = 'result success';
            results.textContent = JSON.stringify(data, null, 2);
        }

        // Show error result
        function showError(error) {
            const results = document.getElementById('results');
            results.className = 'result error';
            results.textContent = `‚ùå Error: ${error.message || error}`;
        }

        // Generate comprehensive trend report
        async function generateTrendReport() {
            showLoading('Generating comprehensive trend report...');
            
            try {
                const region = document.getElementById('region').value;
                const industry = document.getElementById('industry').value;
                const includeCompetitorAnalysis = document.getElementById('competitorAnalysis').checked;

                const data = await apiRequest('/api/trends/weekly-report', {
                    method: 'POST',
                    body: JSON.stringify({
                        region,
                        industry: industry || undefined,
                        includeCompetitorAnalysis
                    })
                });

                currentReport = data.data;
                showSuccess(data);
                displayPlatformOverview(currentReport);
                displayContentCalendar(currentReport);
                
            } catch (error) {
                showError(error);
            }
        }

        // Get quick insights
        async function getQuickInsights() {
            showLoading('Getting quick insights...');
            
            try {
                const platform = document.getElementById('platform').value;
                const region = document.getElementById('region').value;
                
                // Get trending hashtags
                const hashtagsData = await apiRequest(`/api/trends/trending-hashtags?region=${region}&platform=${platform !== 'all' ? platform : ''}&limit=10`);
                
                // Get post ideas
                const ideasData = await apiRequest(`/api/trends/post-ideas?region=${region}&platform=${platform !== 'all' ? platform : ''}&limit=5`);
                
                const insights = {
                    trending_hashtags: hashtagsData.data.hashtags,
                    post_ideas: ideasData.data.ideas,
                    generated_at: new Date().toISOString()
                };
                
                showSuccess(insights);
                
            } catch (error) {
                showError(error);
            }
        }

        // Test all endpoints
        async function testAllEndpoints() {
            showLoading('Testing all trend analysis endpoints...');
            
            const endpoints = [
                { name: 'Weekly Report', url: '/api/trends/weekly-report', method: 'POST', body: { region: 'global' } },
                { name: 'Trending Hashtags', url: '/api/trends/trending-hashtags?limit=5', method: 'GET' },
                { name: 'Trending Audio', url: '/api/trends/trending-audio?limit=5', method: 'GET' },
                { name: 'Content Formats', url: '/api/trends/content-formats', method: 'GET' },
                { name: 'Post Ideas', url: '/api/trends/post-ideas?limit=3', method: 'GET' },
                { name: 'Posting Times', url: '/api/trends/posting-times', method: 'GET' },
                { name: 'Content Calendar', url: '/api/trends/content-calendar', method: 'GET' }
            ];

            const results = {};
            
            try {
                for (const endpoint of endpoints) {
                    try {
                        const options = endpoint.method === 'POST' ? { method: 'POST', body: JSON.stringify(endpoint.body) } : { method: 'GET' };
                        const data = await apiRequest(endpoint.url, options);
                        results[endpoint.name] = { status: 'success', data: data };
                    } catch (error) {
                        results[endpoint.name] = { status: 'error', error: error.message };
                    }
                }
                
                showSuccess(results);
                
            } catch (error) {
                showError(error);
            }
        }

        // Display platform overview
        function displayPlatformOverview(report) {
            const overview = document.getElementById('platformOverview');
            const grid = document.getElementById('platformGrid');
            
            if (!report || !report.platforms) {
                overview.style.display = 'none';
                return;
            }
            
            grid.innerHTML = '';
            
            Object.entries(report.platforms).forEach(([platform, data]) => {
                const card = document.createElement('div');
                card.className = 'platform-card';
                
                const hashtags = data.trendingHashtags.slice(0, 5).map(h => 
                    `<span class="hashtag">${h.hashtag}</span>`
                ).join('');
                
                card.innerHTML = `
                    <div class="platform-header">${platform}</div>
                    <div class="metric-row">
                        <span>Engagement Rate:</span>
                        <span>${data.metrics.engagement_rate}%</span>
                    </div>
                    <div class="metric-row">
                        <span>Virality Score:</span>
                        <span>${data.metrics.virality_score}</span>
                    </div>
                    <div class="metric-row">
                        <span>Reach Potential:</span>
                        <span>${data.metrics.reach_potential}</span>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Top Hashtags:</strong>
                        <div class="hashtag-list">${hashtags}</div>
                    </div>
                    <div style="margin-top: 10px;">
                        <strong>Best Time:</strong>
                        <div>${data.bestPostingTimes[0]?.day} at ${data.bestPostingTimes[0]?.time}</div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            overview.style.display = 'block';
        }

        // Display content calendar
        function displayContentCalendar(report) {
            const calendar = document.getElementById('contentCalendar');
            const content = document.getElementById('calendarContent');
            
            if (!report || !report.contentCalendar) {
                calendar.style.display = 'none';
                return;
            }
            
            const calendarHTML = report.contentCalendar.map(item => `
                <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; background: white;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${item.posting_idea}</div>
                    <div style="color: #666; font-size: 14px;">
                        üìÖ ${item.date} ‚Ä¢ ‚è∞ ${item.best_time} ‚Ä¢ üì± ${item.platform} ‚Ä¢ üéØ ${item.content_type}
                    </div>
                    <div style="margin-top: 5px;">
                        <span style="background: #e9ecef; padding: 2px 8px; border-radius: 12px; font-size: 12px;">
                            ${item.trend_reference}
                        </span>
                    </div>
                </div>
            `).join('');
            
            content.innerHTML = calendarHTML;
            calendar.style.display = 'block';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîç Trend Analysis Test Page Loaded');
            
            // Check if we're authenticated
            const token = getAuthToken();
            if (!token || token === 'test-token') {
                document.getElementById('results').innerHTML = `
                    <div style="color: orange;">
                        ‚ö†Ô∏è No authentication token found. 
                        Please log in to the main application first, or this will use fallback test data.
                    </div>
                `;
            }
        });
    </script>
</body>
</html>