<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Analysis Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            resize: vertical;
            min-height: 200px;
        }
        button {
            background: #3b82f6;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
        }
        button:hover {
            background: #2563eb;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 15px;
            border-radius: 4px;
        }
        .success {
            background: #f0fdf4;
            color: #16a34a;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 6px;
        }
        .section h3 {
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .summary { background: #dbeafe; }
        .insights { background: #fef3c7; }
        .sentiment { background: #f3e8ff; }
        .actions { background: #dcfce7; }
        .recommendations { background: #fce7f3; }
        .score {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        .score.high { background: #dcfce7; color: #166534; }
        .score.medium { background: #fef3c7; color: #92400e; }
        .score.low { background: #fecaca; color: #991b1b; }
        .sentiment-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        .sentiment-positive { background: #dcfce7; color: #166534; }
        .sentiment-neutral { background: #f3f4f6; color: #374151; }
        .sentiment-negative { background: #fecaca; color: #991b1b; }
        .char-count {
            text-align: right;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .char-count.over-limit {
            color: #dc2626;
            font-weight: bold;
        }
        .list-item {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255,255,255,0.7);
            border-radius: 4px;
        }
        .icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <h1>üìÑ Document Analysis Test</h1>
    <p>Test the Document Analysis API with AI-powered insights</p>

    <div class="container">
        <!-- Input Form -->
        <div class="card">
            <h2>Document Input</h2>
            <form id="analysisForm">
                <div class="form-group">
                    <label for="documentText">Document Text *</label>
                    <textarea id="documentText" placeholder="Paste your document content here for analysis..." required></textarea>
                    <div class="char-count" id="charCount">0/10,000 characters</div>
                </div>

                <div class="form-group">
                    <label for="analysisType">Analysis Type</label>
                    <select id="analysisType">
                        <option value="Comprehensive Analysis">Comprehensive Analysis</option>
                        <option value="Summary">Summary</option>
                        <option value="Key Points">Key Points</option>
                        <option value="Sentiment Analysis">Sentiment Analysis</option>
                        <option value="Action Items">Action Items</option>
                    </select>
                </div>

                <button type="submit" id="analyzeBtn">
                    üìä Analyze Document
                </button>
            </form>
        </div>

        <!-- Results Panel -->
        <div class="card">
            <h2>Analysis Result</h2>
            <div id="results">
                <p style="text-align: center; color: #666; padding: 40px;">
                    Enter your document text and click "Analyze Document" to get AI-powered insights
                </p>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('analysisForm');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');
        const documentTextArea = document.getElementById('documentText');
        const charCount = document.getElementById('charCount');

        // Update character count
        documentTextArea.addEventListener('input', () => {
            const length = documentTextArea.value.length;
            charCount.textContent = `${length.toLocaleString()}/10,000 characters`;
            
            if (length > 10000) {
                charCount.classList.add('over-limit');
                analyzeBtn.disabled = true;
            } else {
                charCount.classList.remove('over-limit');
                analyzeBtn.disabled = false;
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const documentText = documentTextArea.value;
            const analysisType = document.getElementById('analysisType').value;

            // Validate content
            if (!documentText.trim()) {
                results.innerHTML = '<div class="error">Please enter document text to analyze</div>';
                return;
            }

            if (documentText.length > 10000) {
                results.innerHTML = '<div class="error">Document text must be 10,000 characters or less</div>';
                return;
            }

            // Show loading state
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'üîÑ Analyzing...';
            results.innerHTML = '<div class="loading">üìä Analyzing document with AI...<br>This may take a few seconds.</div>';

            try {
                const response = await fetch('/api/analyze-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        documentText,
                        analysisType
                    })
                });

                const data = await response.json();

                if (data.success) {
                    let html = '<div class="success">‚úÖ Document analyzed successfully!</div>';
                    
                    // Analysis Type and Score
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">`;
                    html += `<span style="font-weight: bold;">Analysis: ${data.analysisType}</span>`;
                    if (data.overallScore) {
                        const scoreClass = data.overallScore >= 8 ? 'high' : data.overallScore >= 6 ? 'medium' : 'low';
                        html += `<span class="score ${scoreClass}">Score: ${data.overallScore}/10</span>`;
                    }
                    html += `</div>`;

                    // Summary
                    if (data.summary) {
                        html += `
                            <div class="section summary">
                                <h3>üìÑ Summary</h3>
                                <p>${data.summary}</p>
                            </div>
                        `;
                    }

                    // Sentiment
                    if (data.sentiment) {
                        const sentimentClass = `sentiment-${data.sentiment.toLowerCase()}`;
                        html += `
                            <div class="section sentiment">
                                <h3>üòä Sentiment Analysis</h3>
                                <span class="sentiment-badge ${sentimentClass}">${data.sentiment}</span>
                            </div>
                        `;
                    }

                    // Key Insights
                    if (data.keyInsights && data.keyInsights.length > 0) {
                        html += '<div class="section insights"><h3>üí° Key Insights</h3>';
                        data.keyInsights.forEach(insight => {
                            html += `<div class="list-item">
                                <span class="icon">üí°</span>
                                <span>${insight}</span>
                            </div>`;
                        });
                        html += '</div>';
                    }

                    // Strengths
                    if (data.strengths && data.strengths.length > 0) {
                        html += '<div class="section" style="background: #dcfce7;"><h3>‚úÖ Strengths</h3>';
                        data.strengths.forEach(strength => {
                            html += `<div class="list-item">
                                <span class="icon">‚úÖ</span>
                                <span>${strength}</span>
                            </div>`;
                        });
                        html += '</div>';
                    }

                    // Challenges
                    if (data.challenges && data.challenges.length > 0) {
                        html += '<div class="section" style="background: #fed7aa;"><h3>‚ö†Ô∏è Challenges & Limitations</h3>';
                        data.challenges.forEach(challenge => {
                            html += `<div class="list-item">
                                <span class="icon">‚ö†Ô∏è</span>
                                <span>${challenge}</span>
                            </div>`;
                        });
                        html += '</div>';
                    }

                    // Action Items
                    if (data.actionItems && data.actionItems.length > 0) {
                        html += '<div class="section actions"><h3>üéØ Action Items</h3>';
                        data.actionItems.forEach(action => {
                            html += `<div class="list-item">
                                <span class="icon">üéØ</span>
                                <span>${action}</span>
                            </div>`;
                        });
                        html += '</div>';
                    }

                    // Recommendations
                    if (data.recommendations && data.recommendations.length > 0) {
                        html += '<div class="section recommendations"><h3>üöÄ Recommendations</h3>';
                        data.recommendations.forEach(rec => {
                            html += `<div class="list-item">
                                <span class="icon">üöÄ</span>
                                <span>${rec}</span>
                            </div>`;
                        });
                        html += '</div>';
                    }

                    // Conclusion
                    if (data.conclusion) {
                        html += `
                            <div class="section" style="background: #dbeafe; border-left: 4px solid #3b82f6;">
                                <h3>üìä Overall Conclusion</h3>
                                <p style="font-weight: 500;">${data.conclusion}</p>
                            </div>
                        `;
                    }

                    results.innerHTML = html;
                } else {
                    results.innerHTML = `<div class="error">‚ùå Analysis failed: ${data.message || 'Unknown error'}</div>`;
                }
            } catch (error) {
                results.innerHTML = `<div class="error">‚ùå Request failed: ${error.message}</div>`;
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'üìä Analyze Document';
            }
        });

        // Auto-fill example data for quick testing
        document.addEventListener('DOMContentLoaded', () => {
            documentTextArea.value = `Executive Summary

Our Q4 2024 performance exceeded expectations with a 15% increase in revenue compared to Q3. The marketing campaign launched in October generated significant customer engagement, resulting in 2,500 new subscribers. However, we identified several operational challenges that need immediate attention.

Key Achievements:
- Revenue growth of 15% quarter-over-quarter
- Customer satisfaction score improved to 4.2/5
- Successfully launched three new product features
- Reduced customer churn by 8%

Challenges:
- Supply chain delays affected 12% of orders
- Customer support response time increased to 24 hours
- Marketing budget exceeded by 20%

Recommendations:
1. Implement automated inventory management system
2. Hire additional customer support representatives
3. Optimize marketing spend allocation for Q1 2025

The outlook for 2025 remains positive with projected growth of 25% if we address current operational inefficiencies.`;
            
            // Trigger character count update
            documentTextArea.dispatchEvent(new Event('input'));
        });
    </script>
</body>
</html>